import{_ as e,b as t,d as l,e as s,f as o,v as a,g as i}from"./index-6a1593c4.js";import{s as n,g as c,a as u,b as r,r as h,u as d,t as g}from"./trojan-51e6c0ea.js";const p={setup:()=>({Refresh:t,VideoPlay:l,VideoPause:s,RefreshRight:o}),data(){return{timer:null,isFollow:!0,ws:null,scrollHeight:0,fontSize:13,mainStyle:{height:0},typeOptions:[{label:"trojan"},{label:"trojan-go"}],loglevelOptions:[{label:"ALL",value:0},{label:"INFO",value:1},{label:"WARN",value:2},{label:"ERROR",value:3},{label:"FATAL",value:4},{label:"OFF",value:5}],logLineOptions:[{label:"100",value:100},{label:"300",value:300},{label:"1000",value:1e3},{label:"5000",value:5e3},{label:this.$t("all"),value:-1}]}},mounted(){this.$store.commit("SET_NOERROR",!0),this.mainStyle.height=document.body.clientHeight-85+"px",window.onresize=()=>{this.mainStyle.height=document.body.clientHeight-85+"px"};const e=document.getElementById("logshow");e.addEventListener("scroll",(()=>{e.scrollHeight>e.clientHeight&&e.scrollTop<this.scrollHeight?this.isFollow=!1:this.isFollow=!0}),!0),this.getLog(),this.getLoglevel(),this.getTrojanType()},computed:{...Vuex.mapState(["line","loglevel","type","dialogWidth"]),line:{get(){return this.$store.state.line},set(e){this.$store.commit("SET_LINE",e)}},loglevel:{get(){return this.$store.state.loglevel},set(e){this.$store.commit("SET_LOGLEVEL",e)}},type:{get(){return this.$store.state.type},set(e){this.$store.commit("SET_TYPE",e)}}},unmounted(){this.$store.commit("SET_NOERROR",!1),clearInterval(this.timer),this.timer=null,this.ws.close()},methods:{textShow(e){return"80%"===this.dialogWidth?"":e},async setLoglevel(){try{const e=new FormData;e.set("level",this.loglevel);"success"===(await n(e)).Msg&&this.$message({message:this.$t("trojan.loglevelSuccess"),type:"success"})}catch(e){this.getLog()}},async getLoglevel(){const e=await c();"success"===e.Msg?this.loglevel=e.Data.loglevel:this.$message.error(e.Msg)},async getTrojanType(){const e=await a();"success"===e.Msg?this.type=e.Data.trojanType:this.$message.error(e.Msg)},async start(){try{"success"===(await u()).Msg&&this.$message({message:this.$t("trojan.startSuccess"),type:"success"})}catch(e){this.getLog()}},async stop(){"success"===(await r()).Msg&&this.$message({message:this.$t("trojan.stopSuccess"),type:"success"})},async restart(){try{"success"===(await h()).Msg&&this.$message({message:this.$t("trojan.restartSuccess"),type:"success"})}catch(e){this.getLog()}},async update(){try{"success"===(await d()).Msg&&this.$message({message:this.$t("trojan.updateSuccess"),type:"success"})}catch(e){this.getLog()}},async trojanSwitch(){try{const e=new FormData;e.set("type",this.type);const t=await g(e);"success"===t.Msg?this.$message({message:this.$t("trojan.switchSuccess"),type:"success"}):this.$message.error(t.Msg)}catch(e){this.getLog(),this.$message({message:this.$t("trojan.switchSuccess"),type:"success"})}},getLog(){this.isFollow=!0,null!=this.ws&&(this.ws.close(),clearInterval(this.timer),this.timer=null);const e=document.getElementById("logshow");e.innerText="";const t="http:"===document.location.protocol?"ws":"wss";this.ws=new WebSocket(`${t}://${location.host}/trojan/log?line=${this.line}&token=${i.state.UserToken}`),this.ws.onopen=function(){},this.ws.onmessage=function(t){e.append(t.data)},this.ws.onerror=function(e){},this.ws.onclose=function(){},e.scrollTop=e.scrollHeight,this.scrollHeight=e.scrollTop,this.timer=setInterval((()=>{this.isFollow&&(e.scrollTop=e.scrollHeight,this.scrollHeight=e.scrollTop)}),1e3);const l="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",s=document.getElementById("logshow");s.addEventListener(l,(e=>{e.ctrlKey&&(e.preventDefault(),e.deltaY<0?s.style.fontSize=++this.fontSize+"px":s.style.fontSize=--this.fontSize+"px")}),{passive:!1})}}},V=(e=>(Vue.pushScopeId("data-v-73286da6"),e=e(),Vue.popScopeId(),e))((()=>Vue.createElementVNode("textarea",{id:"logshow",readonly:"readonly",class:"el-textarea__inner"},null,-1)));const m=e(p,[["render",function(e,t,l,s,o,a){const i=Vue.resolveComponent("el-button"),n=Vue.resolveComponent("el-button-group"),c=Vue.resolveComponent("el-form-item"),u=Vue.resolveComponent("el-option"),r=Vue.resolveComponent("el-select"),h=Vue.resolveComponent("el-switch"),d=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",{style:Vue.normalizeStyle(o.mainStyle)},[Vue.createVNode(d,{inline:!0,style:{"margin-top":"15px"}},{default:Vue.withCtx((()=>[Vue.createVNode(c,null,{default:Vue.withCtx((()=>[Vue.createVNode(n,null,{default:Vue.withCtx((()=>[Vue.createVNode(i,{type:"primary",icon:s.Refresh,onClick:t[0]||(t[0]=e=>a.update())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(a.textShow(e.$t("update"))),1)])),_:1},8,["icon"]),Vue.createVNode(i,{type:"primary",icon:s.VideoPlay,onClick:t[1]||(t[1]=e=>a.start())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(a.textShow(e.$t("start"))),1)])),_:1},8,["icon"]),Vue.createVNode(i,{type:"primary",icon:s.VideoPause,onClick:t[2]||(t[2]=e=>a.stop())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(a.textShow(e.$t("stop"))),1)])),_:1},8,["icon"]),Vue.createVNode(i,{type:"primary",icon:s.RefreshRight,onClick:t[3]||(t[3]=e=>a.restart())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(a.textShow(e.$t("restart"))),1)])),_:1},8,["icon"])])),_:1})])),_:1}),Vue.createVNode(c,{label:e.$t("type")},{default:Vue.withCtx((()=>[Vue.createVNode(r,{modelValue:a.type,"onUpdate:modelValue":t[4]||(t[4]=e=>a.type=e),placeholder:e.$t("choice"),filterable:"",onChange:t[5]||(t[5]=e=>a.trojanSwitch()),style:{width:"110px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.typeOptions,(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.label,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(c,{label:e.$t("loglevel")},{default:Vue.withCtx((()=>[Vue.createVNode(r,{modelValue:a.loglevel,"onUpdate:modelValue":t[6]||(t[6]=e=>a.loglevel=e),placeholder:e.$t("choice"),filterable:"",onChange:t[7]||(t[7]=e=>a.setLoglevel()),style:{width:"110px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.loglevelOptions,(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(c,{label:e.$t("line")},{default:Vue.withCtx((()=>[Vue.createVNode(r,{modelValue:a.line,"onUpdate:modelValue":t[8]||(t[8]=e=>a.line=e),placeholder:e.$t("choice"),filterable:"",onChange:t[9]||(t[9]=e=>a.getLog()),style:{width:"110px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.logLineOptions,(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(c,{label:e.$t("latest")},{default:Vue.withCtx((()=>[Vue.createVNode(h,{modelValue:o.isFollow,"onUpdate:modelValue":t[10]||(t[10]=e=>o.isFollow=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),V],4)}],["__scopeId","data-v-73286da6"]]);export{m as default};
